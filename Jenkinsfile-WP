pipeline {
     environment {
          AWS_ACCESS_KEY_ID     = credentials('AWS_ACCESS_KEY_ID')
          AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')
      }

agent any
  stages{
      stage
  }
    stage('Deploy App') {
      // Deploy app to AWS EKS, authentication is done with kubeconfig, that is stored as secret file credential in Jenkins
      steps {
          withCredentials([file(credentialsId: 'mykubeconfig', variable: 'KUBECONFIG')]) {
            sh 'kubectl apply -f k8s/secret.yaml'
            sh 'kubectl apply -f k8s'
        }
      }
    }
}