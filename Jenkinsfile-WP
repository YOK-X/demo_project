pipeline {
  environment {
         AWS_CREDENTIALS = credentials('awscredentials')
      }

  agent any

  stages{

    stage('Deploy App') {
      // Deploy app to AWS EKS, authentication is done with kubeconfig, that is stored as secret file credential in Jenkins
      steps {
          withCredentials([file(credentialsId: 'mykubeconfig', variable: 'KUBECONFIG')]) {
            sh 'kubectl apply -f k8s/secret/secret.yaml'
            sh 'kubectl apply -f k8s'
        }
      }
    }
  }
}